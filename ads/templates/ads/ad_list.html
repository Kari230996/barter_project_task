{% extends 'ads/base.html' %}
{% block title %}–û–±—ä—è–≤–ª–µ–Ω–∏—è{% endblock %}

{% block content %}
<h2 class="mb-4">–û–±—ä—è–≤–ª–µ–Ω–∏—è</h2>

<form method="get" class="row g-3 mb-4">
    <div class="col-md-4">
        <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫..." value="{{ request.GET.q }}" class="form-control">
    </div>
    <div class="col-md-3">
        <input type="text" name="category" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è" value="{{ request.GET.category }}"
            class="form-control">
    </div>
    <div class="col-md-3">
        <select name="condition" class="form-select">
            <option value="">–°–æ—Å—Ç–æ—è–Ω–∏–µ</option>
            <option value="new">–ù–æ–≤—ã–π</option>
            <option value="used">–ë/—É</option>
        </select>
    </div>
    <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">–§–∏–ª—å—Ç—Ä</button>
    </div>
</form>

{% if user.is_authenticated %}
<div class="mb-3 d-flex gap-2">
    <a href="{% url 'ad_create' %}" class="btn btn-success">+ –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>
    <a href="{% url 'proposal_list' %}" class="btn btn-outline-primary">–ú–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</a>
</div>
{% else %}
<div class="alert alert-info">–í–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏ –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è.</div>
{% endif %}

<div class="row">
    {% for ad in ads %}
    <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                {% if ad.image_url %}
                <!-- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–æ –∫–ª–∏–∫—É -->
                <img src="{{ ad.image_url }}" class="img-thumbnail mb-2" style="max-height: 150px; cursor: pointer;"
                    data-bs-toggle="modal" data-bs-target="#modalImage{{ ad.id }}">

                <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º -->
                <div class="modal fade" id="modalImage{{ ad.id }}" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content bg-transparent border-0">
                            <div class="modal-body text-center">
                                <img src="{{ ad.image_url }}" class="img-fluid rounded" alt="–§–æ—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è">
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="bg-light border rounded mb-2 d-flex justify-content-center align-items-center"
                    style="height: 150px;">
                    <span class="text-muted">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>
                </div>
                {% endif %}

                <h5 class="card-title">{{ ad.title }}</h5>
                <p class="card-text">{{ ad.description }}</p>
                <p class="mb-1"><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ ad.category }}</p>
                <p class="mb-1"><strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ:</strong> {{ ad.get_condition_display }}</p>
                <p class="mb-1"><strong>–ê–≤—Ç–æ—Ä:</strong> {{ ad.user }}</p>
            </div>
            <div class="card-footer bg-white">
                {% if user.is_authenticated %}
                {% if ad.user == user %}
                <a href="{% url 'ad_update' ad.id %}" class="btn btn-sm btn-warning">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</a>
                <a href="{% url 'ad_delete' ad.id %}" class="btn btn-sm btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                {% else %}
                <a href="{% url 'create_proposal' ad.id %}" class="btn btn-sm btn-outline-info">üîÅ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ–±–º–µ–Ω</a>
                {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <p>–û–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endfor %}
</div>
{% endblock %}